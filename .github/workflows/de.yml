name: GitHub Actions Build and Deploy Project
on:
  push:
    branches:
      - master
jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    strategy:
      matrix:
        node-version: [10.x]
        
    steps:
    - uses: actions/checkout@v1
    - name: Use Node.js 12.19.0
      uses: actions/setup-node@v1
      with:
        node-version: 12.19.0
    - name: yarn install, build
      run: |
        yarn
        yarn build
    - name: Release Github Pages
      uses: igolopolosov/github-action-release-github-pages@master
      env:
        GITHUB_ACCESS_TOKEN: ${{ secrets.MY_DEPLOY_KEY }}
        GITHUB_PAGES_REPO_AUTHOR: ibwei
        GITHUB_PAGES_REPO_NAME: vue3-base
        GITHUB_PAGES_RELEASE_BRANCH: master
        PROJECT_BUILD_FOLDER: dist
        GITHUB_PAGES_CLEANUP_SCRIPT: "rm bundle* && rm index.html"
    - name: Deploy
      uses: appleboy/ssh-action@master # 使用ssh链接服务器
      with:
          host: ${{ secrets.HOST }}
          username: ${{ secrets.USERNAME }}
          password: ${{ secrets.PASSWORD }}
          port: ${{ secrets.PORT }}
          script: |
            rm -rf /data/www/temp
            mkdir /data/www/temp
            cd /data/www/temp
            git clone -b gh-pages https://github.com/ibwei/vue3-base/
            cd /data/www/temp/vue3-base
            mv /data/www/temp/vue3-base/dist/* /data/www/vue3
